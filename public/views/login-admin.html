<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Biblioteca da AV Canido</title>
    <link href="../CSS/style.css" rel="stylesheet" type="text/css" />
    <link rel="icon" href="../imaxes/av_canido_favicon.png" />
    <script type="module" async src="../JavaScript/copyright-auto.js"></script>
   <!--  <script type="module" async src="../JavaScript/chave-login-IF.js"></script> -->

    <!--FONTS = Comfortaa | Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  </head>

  <body>
    <!------------------------------------------------------->
    <!-----------------------   HEADER   -------------------->
    <!------------------------------------------------------->
    <header class="header-xestion">
      <div class="logo-index"><img src="../imaxes/av_canido_logo.png"></div>
      <h2>INICIAR SESIÓN</h2>
      
    </header>
    <!------------------------------------------------------->
    <!------------------------   MAIN   --------------------->
    <!------------------------------------------------------->
    <a href="/administracion">Entrar como admin</a>
    <section class="pax-inicio-sesion">
      <div class="formulario">
        <form id="form-inicio-sesion">
          <div>
            <input id="usuario" type="text" name="Nome_Usuario">
          </div>
          <div>
            <input id="contrasinal" type="password" name="DNI_Usuario">
            <img class="ollo" src="../imaxes/eye.svg">
          </div>
          <button type="submit" id="boton-confirmar-usuario">ENTRAR</button>
          <p class="condicion-usuario"></p>
        </form>
      </div>
    </section>
    <p>(TEMPORAL)Usuario: Administrador</p><p>Constrasinal: Canid0</p>
    <!------------------------------------------------------->
    <!-----------------------   FOOTER   -------------------->
    <!------------------------------------------------------->
    <footer>
        <p class="copyright"></p>
    </footer>
    <script>

const ollo = document.querySelector(".ollo");



function verContrasinal() {
        
    if (contrasinal.type === "password") {
          contrasinal.type = "text";
          ollo.src = "../imaxes/eye-closed.svg";
    } else {
          contrasinal.type = "password";
          ollo.src = "../imaxes/eye.svg";
    }
};

ollo.addEventListener("click", async () => {
    verContrasinal();
});




const formulario = document.querySelector("#form-inicio-sesion");

formulario.addEventListener("submit", async (e) => {
  e.preventDefault(); // 1. OBLIGATORIO
  // DEVOLVE UN OBXETO ESPECIAL
  let formData = new FormData(formulario); // 2. OBLIGATORIO
  console.log("o formData ", formData);

  let valores = formData.entries(); // 3. OBLIGATORIO
  const formJson = Object.fromEntries(valores); // 4. OBLIGATORIO
  console.log(formJson);
  let obxetoEnvio = {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(formJson),
  };

  let respostaLogueo = await fetch("/iniciar-sesion", obxetoEnvio);

  let contestacionRecibida = await respostaLogueo.json();
  console.log("resposta ", contestacionRecibida);
  // COMPROBAMOS A RESPOSTA DO SERVIDOR
  if (contestacionRecibida.estado == "ok") {
     // 'sustitue a URL a partir server '/' creando un endpoint GET'

    localStorage.setItem("token", JSON.stringify(contestacionRecibida.token));
    let menxaxeRecibida = JSON.parse(localStorage.getItem("token"));
    console.log(menxaxeRecibida);
    location.replace("/administracion");
  } else {
    var condicionUsuario = document.querySelector(".condicion-usuario");
    condicionUsuario.innerHTML = "A información non é correcta";
  }
});








    </script>
  </body>
</html>