<!DOCTYPE html>
<!-- ESTE SERÁ EL INDEX QUE TIENE LA BARRA DE BUSQUEDA Y LOS ENLACES A LA PAGINA DE LOGEO Y DEMAS -->
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Biblioteca da AV Canido</title>
    <link href="./CSS/style.css" rel="stylesheet" type="text/css" />
    <link rel="icon" href="./imaxes/av_canido_favicon.png" />
    <script type="module" async src="./JavaScript/copyright-auto.js"></script>

    <!--FONTS = Comfortaa | Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
  </head>

  <body>
    <!------------------------------------------------------->
    <!-----------------------   HEADER   -------------------->
    <!------------------------------------------------------->
    <header class="header-index">
        <nav>
          <ul>
            <li><a href="/nosos-libros">Todos os Libros</a></li>
            <li> | </li>
            <li><a href="/iniciar-sesion">Administración</a></li>
          </ul>
        </nav>
        <div class="logo-centrado">
          <div class="logo-index"><img src="./imaxes/av_canido_logo.png"></div>
          <h1>BIBLIOTECA CÍVICA</h1>
        </div>
    </header>
    <!------------------------------------------------------->
    <!------------------------   MAIN   --------------------->
    <!------------------------------------------------------->
    <section class="pax-inicio-sen-rexistrar">
      <input id="barra-busqueda" type="search" placeholder="Escribe aquí o libro que buscas...">
      <button type="submit" id="boton-busqueda"><img src="./imaxes/search.svg"></button>
    </section>
    <table class="resultados-busqueda"></table>
    <!------------------------------------------------------->
    <!-----------------------   FOOTER   -------------------->
    <!------------------------------------------------------->
    <footer>
      <p class="copyright"></p>  
    </footer>
    <script type="module" async>
const endpoints = {
    libros: {
      leotodos:"/leo-libros",
      buscar:"/buscar-libros/",
    }
  };
  const comunicacionBuscar = async (endpoint) => {
  let datoEnviado = {
    method: "GET",
    headers: {
      "Content-type": "application/json",
    },
    body: JSON.stringify()
  };
  let datosRecibido = await fetch(endpoint,datoEnviado); 
  let datosRecibidoJson = await datosRecibido.json();

  return datosRecibidoJson;
  };



let inputBarraBusqueda = document.querySelector("#barra-busqueda");
let botonBuscar = document.querySelector("#boton-busqueda");
let divResultado = document.querySelector(".resultados-busqueda");

botonBuscar.addEventListener("click", async() =>{

  let valorInput = inputBarraBusqueda.value;
  
  let textoTitulo = valorInput.trim().toLowerCase();
  console.log("Valor Input-->", textoTitulo);
  
  let datoRecibido = await comunicacionBuscar(`buscar-libros/?textoTitulo=${textoTitulo}`);
console.log(datoRecibido.mensaxe)
 ////////////
 let tabla = document.createElement("table")
 tabla.setAttribute("class", "tabla-libros-no-editable");
 divResultado.append(tabla);
 let fila = document.createElement("tr");
 tabla.append(fila);

 let tdTitulo = document.createElement("th");
 tdTitulo.innerText = "Título";
 fila.append(tdTitulo);
 let tdAutor = document.createElement("th");
 tdAutor.innerText = "Autor";
 fila.append(tdAutor);
 let tdIsbn = document.createElement("th");
 tdIsbn.innerText = "ISBN";
 fila.append(tdIsbn);
 let tdEditorial = document.createElement("th");
 tdEditorial.innerText = "Editorial";
 fila.append(tdEditorial);
 let tdAno = document.createElement("th");
 tdAno.innerText = "Ano de Edición";
 fila.append(tdAno);
 let tdXenero = document.createElement("th");
 tdXenero.innerText = "Xénero";
 fila.append(tdXenero);

 let i = 0;
console.log(datoRecibido.mensaxe.length)
 
     for (i = 0; i < datoRecibido.mensaxe.length; i++) {
    let datosLibros = datoRecibido.mensaxe[i];
  console.log(datosLibros)
     let fila = document.createElement("tr");
    tabla.append(fila);
    for (let propiedade in datosLibros) {
    /*
    if(datosLibros.Prestado_Libro_Prestado == 1){
      datosLibros.Prestado_Libro_Prestado = "Prestado"
    }else if(datosLibros.Prestado_Libro_Prestado == "0") {
      datosLibros.Prestado_Libro_Prestado = "Disponible"
    }
  */
    let celda = document.createElement("td");
    let dato = JSON.stringify(datosLibros[propiedade]);
    //console.log("ESTOOOOOOOOOOOO",datosLibros.Prestado_Libro_Prestado);
    celda.innerHTML = dato.replace(/\"/g, "");
    fila.append(celda); 
  }

    
}
})




    </script>
</body>
</html>